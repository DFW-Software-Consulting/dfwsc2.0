---
title: "Onboard UI Update – Plan"
phase: Plan
date: "2026-01-13_15-32-26"
owner: "claude-plan-agent"
parent_ticket: "memory-bank/tickets/04-onboard-ui.md"
git_commit_at_plan: "7133f53"
tags: [plan, onboard-ui, frontend, admin-dashboard]
---

## Goal
Transform the `/onboard` page into a dual-purpose interface that serves both client onboarding (existing token-based flow) and admin management (new dashboard functionality). The singular focus is to enable admins to log in, view all clients, create new clients with onboarding tokens, and deactivate clients - all without leaving the `/onboard` page.

## Scope & Assumptions

### In Scope
- Frontend-only changes to `/onboard` page component
- Two-column layout: Client token entry (left) + Admin login/dashboard (right)
- Admin dashboard with three core actions:
  1. View client list (name, email, status, stripeAccountId)
  2. Create new client + generate token with copy-to-clipboard
  3. Deactivate/activate client status toggle
- JWT authentication flow using `sessionStorage`
- UI state management for logged-in vs logged-out admin states
- Integration with existing backend API endpoints (all fully implemented)

### Out of Scope
- Backend API changes (all endpoints already exist and tested)
- Route changes (stays at `/onboard`)
- Multi-page admin portal
- Client editing beyond status changes
- Payment processing or Stripe dashboard integration
- User role management beyond single admin

### Assumptions
- Backend APIs are stable and tested (`POST /api/v1/auth/login`, `GET /api/v1/clients`, `POST /api/v1/accounts`, `PATCH /api/v1/clients/:id`)
- Admin credentials configured in backend environment variables
- Client token onboarding flow must remain unchanged for existing customers
- React application uses functional components with hooks
- Tailwind CSS is available for styling
- `sessionStorage` is acceptable for JWT persistence (no `localStorage` or cookies required)

### Constraints
- Must not break existing client token onboarding flow
- No new npm dependencies (use existing React, Tailwind, native fetch)
- Must work within Docker environment on port 8080
- Desktop-first design (mobile responsive is secondary)

---

## Deliverables (DoD)

### D1: Updated OnboardClient Component
- Two-section layout visible on page load
- Client token entry section (left) unchanged from current implementation
- Admin section (right) with login form when not authenticated
- Admin section transforms to dashboard after successful login

**Acceptance Criteria:**
- Page renders both sections side-by-side on wide screens
- Client token flow works identically to current implementation
- Admin login form accepts username + password
- Successful login stores JWT in `sessionStorage` and shows dashboard
- Failed login displays error message without page refresh
- Dashboard remains visible on page refresh if JWT still valid

### D2: Admin Dashboard - Client List
- Table/list showing all clients with columns: name, email, status, stripeAccountId
- Empty state when no clients exist
- Auto-refresh on create/deactivate actions

**Acceptance Criteria:**
- Calls `GET /api/v1/clients` with `Authorization: Bearer <jwt>` header
- Displays all returned client records
- Shows "No clients yet" message when array is empty
- Handles 401/403 errors by clearing JWT and showing login form
- Displays loading state during fetch

### D3: Admin Dashboard - Create Client Action
- Form with name + email inputs
- "Create Client" button that calls `POST /api/v1/accounts`
- Success shows generated token + onboarding URL
- Copy-to-clipboard button for token
- Copy-to-clipboard button for full onboarding URL

**Acceptance Criteria:**
- Form validates name and email are not empty
- Calls `POST /api/v1/accounts` with admin JWT
- Displays `onboardingToken` and `onboardingUrlHint` in response
- Copy buttons use `navigator.clipboard.writeText()` with success feedback
- Client list refreshes after successful creation
- Form resets after successful creation

### D4: Admin Dashboard - Deactivate/Activate Client
- Each client row has status indicator and toggle action
- Clicking action calls `PATCH /api/v1/clients/:id` with opposite status
- Optimistic UI update with rollback on error

**Acceptance Criteria:**
- Active clients show "Deactivate" button/link
- Inactive clients show "Activate" button/link
- Calls `PATCH /api/v1/clients/:id` with `{ status: "active|inactive" }`
- Client list updates immediately (optimistic)
- Rolls back on API error with error message
- Handles 404 errors gracefully

---

## Readiness (DoR)

### Preconditions
- ✅ Backend API endpoints fully implemented and tested
- ✅ Admin credentials configured (`ADMIN_USERNAME`, `ADMIN_PASSWORD`, `JWT_SECRET`)
- ✅ Docker environment running (`docker-compose up`)
- ✅ Current `/onboard` page code reviewed and understood
- ✅ `VITE_API_URL` environment variable configured in frontend

### Required Access
- ✅ Write access to `/front/src/pages/OnboardClient.jsx`
- ✅ Docker container restart capability for frontend builds
- ✅ Browser with sessionStorage support

### Data Requirements
- ✅ Valid admin credentials for testing
- ⚠️ Optional: Seed data with test clients (can be created via new UI)

---

## Milestones

### M1: Layout & Authentication (Core Structure)
- Split OnboardClient.jsx into two-column layout
- Add admin login form component
- Implement JWT authentication flow with sessionStorage
- Add logout functionality
**Target:** Foundation ready for dashboard features

### M2: Dashboard - Read Operations (Client List)
- Fetch and display client list from `GET /api/v1/clients`
- Handle authentication errors (401/403)
- Add loading states and empty states
- Style client list table/cards
**Target:** Admins can view all clients after login

### M3: Dashboard - Write Operations (Create & Deactivate)
- Implement create client form
- Add copy-to-clipboard for token and URL
- Implement status toggle (activate/deactivate)
- Add error handling and success feedback
**Target:** Full CRUD operations functional

### M4: Polish & Testing (Hardening)
- Add comprehensive error handling
- Implement loading spinners and disabled states
- Add user feedback (toasts/alerts for success/error)
- Manual testing of all flows in Docker environment
**Target:** Production-ready UI with good UX

---

## Work Breakdown (Tasks)

### Task 1: Refactor OnboardClient.jsx Layout
**Owner:** Developer
**Estimate:** Small
**Dependencies:** None
**Milestone:** M1

**Description:**
Restructure the existing single-section page into a two-column grid layout using Tailwind CSS. Left column contains existing client token entry, right column will house admin section.

**Acceptance Tests:**
- [ ] Page displays two columns on screens ≥1024px width
- [ ] Left column shows existing token entry form unchanged
- [ ] Right column shows placeholder for admin section
- [ ] Layout is responsive (stacks vertically on mobile)
- [ ] Dark theme styling consistent across both sections

**Files/Interfaces:**
- `front/src/pages/OnboardClient.jsx`: Add grid container, split into two sections

---

### Task 2: Implement Admin Login Component
**Owner:** Developer
**Estimate:** Medium
**Dependencies:** Task 1
**Milestone:** M1

**Description:**
Create admin login form with username/password inputs that calls `POST /api/v1/auth/login`. Store JWT in sessionStorage on success. Add conditional rendering to show login form vs dashboard based on auth state.

**Acceptance Tests:**
- [ ] Login form renders with username + password fields
- [ ] Form submission calls `POST /api/v1/auth/login` with credentials
- [ ] Success response stores JWT in `sessionStorage.setItem('adminToken', token)`
- [ ] Failed login shows error message without page refresh
- [ ] Component state tracks `isLoggedIn` boolean
- [ ] Page refresh checks sessionStorage and maintains logged-in state
- [ ] Logout button clears sessionStorage and returns to login form

**Files/Interfaces:**
- `front/src/pages/OnboardClient.jsx`: Add login form, auth state management, sessionStorage integration
- API: `POST /api/v1/auth/login` (already implemented)

---

### Task 3: Build Client List Display
**Owner:** Developer
**Estimate:** Medium
**Dependencies:** Task 2
**Milestone:** M2

**Description:**
Fetch client list from `GET /api/v1/clients` using stored JWT and display in table/card format. Show loading states and handle auth errors by logging out.

**Acceptance Tests:**
- [ ] Component fetches `GET /api/v1/clients` on mount when logged in
- [ ] Includes `Authorization: Bearer ${token}` header from sessionStorage
- [ ] Displays loading spinner during fetch
- [ ] Renders table with columns: name, email, status, stripeAccountId
- [ ] Shows "No clients yet" message when response is empty array
- [ ] 401/403 errors trigger logout (clear sessionStorage, show login)
- [ ] Status badge shows "Active" (green) or "Inactive" (gray/red)

**Files/Interfaces:**
- `front/src/pages/OnboardClient.jsx`: Add client list table, fetch logic, error handling
- API: `GET /api/v1/clients` (already implemented)

---

### Task 4: Implement Create Client Form
**Owner:** Developer
**Estimate:** Medium
**Dependencies:** Task 3
**Milestone:** M3

**Description:**
Add form above client list with name + email inputs and "Create Client" button. On submit, call `POST /api/v1/accounts` and display generated token with copy-to-clipboard functionality.

**Acceptance Tests:**
- [ ] Form has name and email text inputs with labels
- [ ] "Create Client" button disabled when either field is empty
- [ ] Button shows loading state during API call
- [ ] Calls `POST /api/v1/accounts` with `{ name, email }` and JWT auth header
- [ ] Success displays modal/section with `onboardingToken` and `onboardingUrlHint`
- [ ] Token display has "Copy Token" button using `navigator.clipboard.writeText()`
- [ ] URL display has "Copy URL" button
- [ ] Copy buttons show "Copied!" feedback for 2 seconds
- [ ] Client list refreshes after successful creation
- [ ] Form inputs reset to empty after success
- [ ] API errors display error message without crashing

**Files/Interfaces:**
- `front/src/pages/OnboardClient.jsx`: Add create form, modal/section for token display, clipboard integration
- API: `POST /api/v1/accounts` (already implemented)

---

### Task 5: Add Client Status Toggle
**Owner:** Developer
**Estimate:** Small
**Dependencies:** Task 3
**Milestone:** M3

**Description:**
Add "Activate"/"Deactivate" button to each client row that calls `PATCH /api/v1/clients/:id`. Implement optimistic UI update with rollback on error.

**Acceptance Tests:**
- [ ] Active clients show "Deactivate" button (or icon)
- [ ] Inactive clients show "Activate" button (or icon)
- [ ] Click immediately updates UI (optimistic rendering)
- [ ] Calls `PATCH /api/v1/clients/:id` with `{ status: "active"|"inactive" }`
- [ ] Success: UI remains updated
- [ ] Error: UI reverts to previous state and shows error message
- [ ] 404 errors show "Client not found" message
- [ ] Button disabled during API call to prevent double-clicks

**Files/Interfaces:**
- `front/src/pages/OnboardClient.jsx`: Add toggle button, optimistic update logic
- API: `PATCH /api/v1/clients/:id` (already implemented)

---

### Task 6: Add Error Handling & UX Polish
**Owner:** Developer
**Estimate:** Small
**Dependencies:** Tasks 2, 3, 4, 5
**Milestone:** M4

**Description:**
Add comprehensive error handling, loading states, success feedback, and improve overall UX. Ensure all user actions have clear feedback.

**Acceptance Tests:**
- [ ] All API errors display user-friendly messages (not raw error text)
- [ ] Network errors show "Connection failed" message
- [ ] Success actions show temporary success message/toast
- [ ] All buttons have disabled states during loading
- [ ] Loading spinners consistent across all async operations
- [ ] Form validation errors highlighted on relevant inputs
- [ ] No console errors during normal operation
- [ ] Page remains functional after any error (no broken state)

**Files/Interfaces:**
- `front/src/pages/OnboardClient.jsx`: Add error boundaries, success notifications, improved loading states

---

## Risks & Mitigations

| Risk | Impact | Likelihood | Mitigation | Trigger |
|------|--------|------------|------------|---------|
| **JWT expires during session** | Admin logged out unexpectedly | Medium | Implement token refresh check before API calls; show "Session expired" message | 401 errors on valid token |
| **sessionStorage cleared by browser** | Lost auth state on tab duplicate | Low | Document behavior; consider localStorage if needed | User reports unexpected logouts |
| **Large client lists (>100)** | Performance degradation, slow render | Low | Current scope has no pagination; document as future enhancement | Testing with many clients |
| **Clipboard API not supported** | Copy buttons fail | Very Low | Feature detect `navigator.clipboard` and show fallback (select text) | Older browser testing |
| **CORS issues from Docker** | API calls fail from frontend | Low | Verify `FRONTEND_ORIGIN` includes `http://localhost:8080` | 403 CORS errors in console |
| **Breaking existing client flow** | Customers cannot onboard | High | Keep left column logic identical; test token flow after changes | QA testing with token |

---

## Test Strategy

### Manual Testing Checklist

**Admin Login Flow:**
- [ ] Login with valid credentials → Shows dashboard
- [ ] Login with invalid credentials → Shows error, stays on login
- [ ] Refresh page while logged in → Dashboard persists
- [ ] Logout → Returns to login form, clears sessionStorage
- [ ] Login with expired/invalid JWT in sessionStorage → Shows login form

**Client List:**
- [ ] Empty database → Shows "No clients yet"
- [ ] Multiple clients → All displayed correctly
- [ ] Mix of active/inactive → Status badges correct

**Create Client:**
- [ ] Empty fields → Button disabled
- [ ] Valid name+email → Token generated and displayed
- [ ] Copy token button → Clipboard contains token
- [ ] Copy URL button → Clipboard contains full URL
- [ ] After creation → New client appears in list

**Status Toggle:**
- [ ] Active client deactivate → Status changes to inactive
- [ ] Inactive client activate → Status changes to active
- [ ] Network error during toggle → Reverts to original status + error message

**Client Token Flow (Regression):**
- [ ] Token in URL query param → Auto-fills input
- [ ] Manual token entry → Submits successfully
- [ ] Invalid token → Shows error message
- [ ] Valid token → Redirects to Stripe onboarding

**Error Scenarios:**
- [ ] Backend down → Shows connection error
- [ ] JWT expired → Logs out and shows login
- [ ] Invalid client ID on toggle → Shows "not found" error
- [ ] Rate limit exceeded → Shows rate limit message

### Integration Points
- Frontend: `http://localhost:8080/onboard`
- Backend: `http://localhost:4242/api/v1/*` (via `VITE_API_URL`)
- Docker: `docker-compose up -d web api db`

### Test Data Setup
```bash
# Create test admin (backend .env)
ADMIN_USERNAME=admin
ADMIN_PASSWORD=test123
JWT_SECRET=your-secret-key-min-32-chars

# Create test client via new UI or backend
# No additional setup required - database starts empty
```

---

## References

### Ticket
- Original ticket: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/memory-bank/tickets/04-onboard-ui.md`

### Current Implementation
- Frontend component: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/front/src/pages/OnboardClient.jsx`
- Frontend routing: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/front/src/App.jsx`

### Backend APIs (All Implemented)
- Auth: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/backend/src/routes/auth.ts:13-73`
- Client list: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/backend/src/routes/clients.ts:15-42`
- Create client: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/backend/src/routes/connect.ts:28-59`
- Update status: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/backend/src/routes/clients.ts:44-97`

### Database Schema
- Clients table: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/backend/src/db/schema.ts:3-13`
- Onboarding tokens: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/backend/src/db/schema.ts:24-32`

### Infrastructure
- Docker compose: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/docker-compose.yml`
- Frontend Dockerfile: `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/Dockerfile.front`

---

## Alternative Approach (Not Recommended)

### Option B: Separate Admin Route
Create new `/admin` route with dashboard functionality, keep `/onboard` unchanged.

**Pros:**
- Cleaner separation of concerns
- No risk to existing client flow
- Easier to add admin features later

**Cons:**
- Requires new route registration
- Additional navigation complexity
- Doesn't meet ticket requirement ("shared page")
- More files to maintain

**Decision:** Stick with Option A (single page) per ticket requirements. The dual-layout approach is feasible given the backend APIs are stable and tested.

---

## Agents & Subagents

This plan leveraged the following agents for research:
- **Explore agent** (aabac8b): Analyzed current `/onboard` page structure and client token flow
- **Codebase-analyzer agent** (aeac7cf): Documented all backend API endpoints and auth system

No additional agents required for execution phase. All implementation work is straightforward frontend development using existing APIs.

---

## Final Gate

### Plan Summary
- **Plan Path:** `/home/jeremy/jcFolder/dfwsc/dfwsc2.0/memory-bank/plan/2026-01-13_15-32-26_onboard-ui.md`
- **Milestones:** 4 (Layout & Auth → Client List → Create & Toggle → Polish)
- **Tasks:** 6 total
  - Task 1: Layout refactor (M1)
  - Task 2: Admin login (M1)
  - Task 3: Client list display (M2)
  - Task 4: Create client form (M3)
  - Task 5: Status toggle (M3)
  - Task 6: Error handling & UX (M4)
- **Gates:**
  - DoR: All backend APIs verified as complete ✅
  - DoD: 4 deliverables with 23 total acceptance criteria
  - Risk mitigation: 6 risks identified with triggers
  - Test strategy: 30+ manual test cases

### Key Success Criteria
1. Client token onboarding flow remains unchanged (regression-free)
2. Admin can login and see dashboard without route change
3. All CRUD operations functional with proper auth
4. JWT persists in sessionStorage across page refreshes
5. Copy-to-clipboard works for tokens and URLs

### Next Steps
Execute this plan using:
```bash
/execute "memory-bank/plan/2026-01-13_15-32-26_onboard-ui.md"
```

Or begin implementation with Task 1 (Layout refactor).

### Implementation Notes
- **Single file modification:** All work confined to `front/src/pages/OnboardClient.jsx`
- **No backend changes:** All APIs already implemented and tested
- **No new dependencies:** Use React hooks, Tailwind CSS, native fetch API
- **Docker environment:** Test in running containers at `http://localhost:8080/onboard`
- **Estimated effort:** 4-6 hours for experienced React developer

---

**Plan Status:** READY FOR EXECUTION ✅
**Blocked By:** None
**Blocking:** None
**Last Updated:** 2026-01-13 15:32:26
