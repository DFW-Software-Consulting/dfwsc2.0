FROM node:20-alpine AS development

ENV NODE_ENV=development
WORKDIR /app

RUN addgroup -S appgroup && adduser -S appuser -G appgroup

COPY package*.json ./
RUN npm ci && chown -R appuser:appgroup /app

# Install ts-node and nodemon for hot reload
RUN npm install -g ts-node nodemon

RUN mkdir -p /app/public /app/dist && chown -R appuser:appgroup /app

RUN apk add --no-cache curl

USER appuser

HEALTHCHECK --interval=30s --timeout=5s --retries=5 \
  CMD curl -fsS http://localhost:4242/api/v1/health || exit 1

# Source code will be mounted as volumes
# This will be overridden by docker-compose
CMD ["npm", "run", "dev"]
