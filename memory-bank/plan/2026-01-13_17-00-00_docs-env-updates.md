---
title: "Docs + Env Updates – Plan"
phase: Plan
date: "2026-01-13T17:00:00Z"
owner: "claude-sonnet-4.5"
parent_research: "memory-bank/tickets/05-docs-env.md"
git_commit_at_plan: "75f3050"
tags: [plan, documentation, environment, admin-auth]
---

## Goal

Update documentation and environment templates to reflect the newly implemented admin authentication system and client management endpoints. Ensure all documentation accurately describes the current API surface and required environment configuration.

**Singular Focus**: Synchronize documentation with implemented code changes for admin auth, client list, and client status management features.

## Scope & Assumptions

### In Scope
1. Update `backend/.env.example` to include admin authentication variables
2. Update `backend/documentation/docs/env_setup.md` with admin auth configuration
3. Update `backend/documentation/docs/api.md` with new auth and client endpoints
4. Update `backend/README.md` environment variables table and routes table
5. Update root `README.md` API routes table and environment variables section
6. Verify all documentation accurately reflects implementation from commits b68015d..75f3050

### Out of Scope
- Creating new documentation files
- Frontend-specific documentation (admin dashboard is embedded in OnboardClient.jsx)
- Adding Swagger/OpenAPI specifications
- Performance or security improvements to existing code
- Additional feature development

### Assumptions
- Admin authentication system is fully implemented and tested (from previous execution)
- All endpoints (`POST /api/v1/auth/login`, `GET /api/v1/clients`, `PATCH /api/v1/clients/:id`) are functional
- Environment variables (ADMIN_USERNAME, ADMIN_PASSWORD, JWT_SECRET, JWT_EXPIRY) are validated in `src/lib/env.ts`
- No breaking changes to existing public client onboarding flow

### Constraints
- Must maintain consistency across all documentation files
- Documentation should match actual implementation, not idealized state
- Keep documentation concise and actionable

## Deliverables (DoD)

1. **Updated env.example** - Contains ADMIN_USERNAME, ADMIN_PASSWORD, JWT_SECRET, JWT_EXPIRY with clear comments
2. **Updated env_setup.md** - Documents admin auth variables with setup instructions
3. **Updated api.md** - Includes POST /auth/login, GET /clients, PATCH /clients/:id endpoints with auth requirements
4. **Updated backend/README.md** - Environment variables table and routes table reflect admin auth
5. **Updated root README.md** - API routes table includes new endpoints with auth column
6. **Verification Test** - One simple test to confirm documentation accuracy (reading and validating env.example completeness)

### Acceptance Criteria
- All three admin auth env vars documented in all relevant locations
- JWT_EXPIRY optional variable documented with default value (1h)
- API documentation describes authentication header format (Bearer token)
- Auth endpoint documented with rate limiting (5 requests per 15 minutes)
- Client endpoints documented with admin-only JWT requirement
- All route tables consistent across documentation files
- Documentation references point to actual file locations in codebase

## Readiness (DoR)

### Prerequisites Met
- ✅ Admin authentication implementation completed (commits b68015d..75f3050)
- ✅ Backend environment validation includes admin auth variables
- ✅ Implementation verified through execution summary (EXECUTION_SUMMARY_2026-01-13_15-32-26.md)
- ✅ Current git state known (75f3050)

### Required Access
- Write access to documentation files in backend/documentation/docs/
- Write access to backend/.env.example and backend/README.md
- Write access to root README.md

### Dependencies
- None - documentation-only changes

## Milestones

### M1: Environment Documentation (Foundation)
**Target**: Update all environment configuration documentation
- Update backend/.env.example with admin auth variables
- Update backend/documentation/docs/env_setup.md with admin configuration section
- Verify consistency between env.example files (backend vs docker env vars)

### M2: API Documentation (Core)
**Target**: Document authentication and client management endpoints
- Update backend/documentation/docs/api.md with auth section
- Add authentication header documentation
- Document three new endpoints with request/response examples

### M3: README Updates (Integration)
**Target**: Update high-level README files for consistency
- Update backend/README.md environment and routes tables
- Update root README.md API routes and environment sections
- Cross-reference verification across all docs

### M4: Verification & Quality Gate (Validation)
**Target**: Ensure documentation accuracy and completeness
- Create simple test to validate env.example completeness
- Manual review of all updated documentation
- Confirm no drift between docs and implementation

## Work Breakdown (Tasks)

### Task 1: Update backend/.env.example
**Owner**: claude-sonnet-4.5
**Estimate**: 10 minutes
**Dependencies**: None
**Milestone**: M1

**Description**: Add admin authentication environment variables to backend/.env.example with clear inline comments explaining each variable's purpose and format.

**Acceptance Tests**:
- [ ] ADMIN_USERNAME variable present with example value "admin"
- [ ] ADMIN_PASSWORD variable present with security guidance comment
- [ ] JWT_SECRET variable present with length requirement comment (minimum 32 characters)
- [ ] JWT_EXPIRY variable present as optional with default "1h" noted
- [ ] Comments explain bcrypt hash support for ADMIN_PASSWORD in production

**Files/Interfaces**: `backend/.env.example`

---

### Task 2: Update backend/documentation/docs/env_setup.md
**Owner**: claude-sonnet-4.5
**Estimate**: 15 minutes
**Dependencies**: Task 1
**Milestone**: M1

**Description**: Add admin authentication section to environment setup documentation with configuration guidance and security best practices.

**Acceptance Tests**:
- [ ] New "Admin Authentication" section added after SMTP section
- [ ] All four admin auth variables documented (ADMIN_USERNAME, ADMIN_PASSWORD, JWT_SECRET, JWT_EXPIRY)
- [ ] Security notes included (bcrypt hashing, secret rotation, expiry tuning)
- [ ] Example configuration snippet provided
- [ ] Notes section updated with admin auth verification steps

**Files/Interfaces**: `backend/documentation/docs/env_setup.md`

---

### Task 3: Update backend/documentation/docs/api.md
**Owner**: claude-sonnet-4.5
**Estimate**: 20 minutes
**Dependencies**: None
**Milestone**: M2

**Description**: Document authentication and client management endpoints in API reference with complete request/response examples and authentication requirements.

**Acceptance Tests**:
- [ ] "Authentication & Headers" section updated to include JWT Bearer token format
- [ ] POST /api/v1/auth/login endpoint fully documented (request body, response, rate limiting, error codes)
- [ ] GET /api/v1/clients endpoint documented (auth requirement, response format)
- [ ] PATCH /api/v1/clients/:id endpoint documented (auth requirement, request body, response format)
- [ ] New "Admin Authentication" section added to endpoint list
- [ ] New "Client Management" section added to endpoint list
- [ ] Authentication requirements clearly marked for each protected endpoint

**Files/Interfaces**: `backend/documentation/docs/api.md`

---

### Task 4: Update backend/README.md
**Owner**: claude-sonnet-4.5
**Estimate**: 15 minutes
**Dependencies**: Task 1, Task 3
**Milestone**: M3

**Description**: Update environment variables table and routes table in backend README to include admin authentication configuration and new endpoints.

**Acceptance Tests**:
- [ ] Environment Variables table includes ADMIN_USERNAME, ADMIN_PASSWORD, JWT_SECRET (required)
- [ ] Environment Variables table includes JWT_EXPIRY (optional) with default "1h"
- [ ] Routes table includes POST /api/v1/auth/login (Public role)
- [ ] Routes table includes GET /api/v1/clients (Admin role)
- [ ] Routes table includes PATCH /api/v1/clients/:id (Admin role)
- [ ] Route descriptions accurately reflect implementation

**Files/Interfaces**: `backend/README.md`

---

### Task 5: Update root README.md
**Owner**: claude-sonnet-4.5
**Estimate**: 15 minutes
**Dependencies**: Task 4
**Milestone**: M3

**Description**: Update root README API routes table and environment variables documentation to include admin authentication features.

**Acceptance Tests**:
- [ ] API Routes table includes POST /api/v1/auth/login (Public auth)
- [ ] API Routes table includes GET /api/v1/clients (Admin auth)
- [ ] API Routes table includes PATCH /api/v1/clients/:id (Admin auth)
- [ ] Backend environment variables section mentions admin authentication
- [ ] Consistency with backend/README.md maintained

**Files/Interfaces**: `README.md` (root)

---

### Task 6: Create Documentation Verification Test
**Owner**: claude-sonnet-4.5
**Estimate**: 10 minutes
**Dependencies**: Tasks 1-5
**Milestone**: M4

**Description**: Create one simple test that validates the completeness of backend/.env.example by checking for presence of all required admin auth variables.

**Acceptance Tests**:
- [ ] Test file created in appropriate location (backend/src/__tests__/ or similar)
- [ ] Test reads backend/.env.example file
- [ ] Test validates presence of ADMIN_USERNAME, ADMIN_PASSWORD, JWT_SECRET
- [ ] Test validates JWT_EXPIRY is documented (even if optional)
- [ ] Test passes with current env.example state
- [ ] Test provides clear error messages if variables are missing

**Files/Interfaces**: `backend/src/__tests__/env-example.test.ts` (new file)

---

## Risks & Mitigations

| Risk | Impact | Likelihood | Mitigation | Trigger |
|------|--------|-----------|------------|---------|
| Documentation drift from implementation | Medium | Low | Reference actual source files during documentation; cross-check endpoint paths with routes files | Documentation completed |
| Inconsistent terminology across docs | Low | Medium | Use consistent terminology: "admin authentication", "JWT Bearer token", "client status"; create terminology reference | First doc updated |
| Missing security guidance | Medium | Low | Include notes about bcrypt hashing, JWT secret strength, and credential rotation | env_setup.md update |
| Over-documentation complexity | Low | Medium | Keep documentation concise and action-oriented; avoid speculative future features | Each doc update |
| Breaking existing documentation links | Low | Low | Verify no internal documentation cross-references are broken | Final review |

## Test Strategy

### Documentation Validation Test (NEW)
**File**: `backend/src/__tests__/env-example.test.ts`

**Purpose**: Automated verification that backend/.env.example contains all required admin authentication variables.

**Scope**:
- Read backend/.env.example file
- Parse for presence of: ADMIN_USERNAME, ADMIN_PASSWORD, JWT_SECRET, JWT_EXPIRY (commented)
- Validate inline comments provide guidance
- Fail with clear message if any variable missing

**Why One Test**:
- Documentation changes are primarily textual and human-verified
- Single test ensures critical env.example template stays current
- Prevents regression if env.example accidentally loses admin auth vars
- Additional tests would validate prose quality (not cost-effective)

**Execution**: Run via `npm test` in backend directory

## Gates & Quality Checks

### Entry Gate (Before Starting)
- ✅ Execution summary reviewed and understood
- ✅ Current implementation verified via source code inspection
- ✅ All prerequisite files identified and accessible

### Task Gate (Before Marking Complete)
- All acceptance tests for the task pass
- Content reviewed for accuracy against source code
- Consistent terminology used

### Milestone Gates
**M1 Complete**: All environment documentation updated and consistent
**M2 Complete**: All API endpoints documented with examples
**M3 Complete**: All README files updated and cross-referenced
**M4 Complete**: Verification test passing, manual review complete

### Exit Gate (Before Merge)
- All 6 tasks completed with acceptance criteria met
- Documentation verification test created and passing
- Manual review confirms no drift between docs and implementation
- No broken internal documentation links
- Git diff reviewed for unintended changes

## References

### Source Files (Implementation)
- `backend/src/lib/env.ts:6-19` - Admin auth env var validation
- `backend/src/routes/auth.ts:1-75` - Login endpoint implementation
- `backend/src/routes/clients.ts:1-100` - Client list and status endpoints
- `backend/src/lib/auth.ts` - JWT signing and verification
- `backend/.env.example` - Current environment template

### Documentation Files (To Update)
- `backend/.env.example`
- `backend/documentation/docs/env_setup.md`
- `backend/documentation/docs/api.md`
- `backend/README.md`
- `README.md` (root)

### Context Documents
- Ticket: `memory-bank/tickets/05-docs-env.md`
- Execution Summary: `EXECUTION_SUMMARY_2026-01-13_15-32-26.md`
- Plan Source: `memory-bank/plan/2026-01-13_15-32-26_onboard-ui.md` (previous work)

### GitHub References
- Branch: `client-status-db`
- Base commit: `75f3050` (Task 6: Add toast notifications and UX improvements)
- Implementation commits: `b68015d..75f3050`

## Agents & Subagent Strategy

### Agent Deployment Plan (Max 3 Parallel)

**Subagent 1: codebase-analyzer**
- **Purpose**: Analyze implementation to extract exact endpoint signatures, environment variables, and auth flow
- **Target Files**: `backend/src/routes/auth.ts`, `backend/src/routes/clients.ts`, `backend/src/lib/env.ts`, `backend/src/lib/auth.ts`
- **Output**: Structured summary of endpoints (paths, methods, auth requirements, request/response schemas)
- **Timing**: Deploy immediately at plan start

**Subagent 2: context-synthesis**
- **Purpose**: Review completed documentation updates to identify inconsistencies, missing details, or areas needing clarification
- **Target Files**: All updated documentation files after tasks complete
- **Output**: Report of documentation issues, inconsistencies, or missing elements
- **Timing**: Deploy after Tasks 1-5 complete, before Task 6

**No Subagent 3**: Documentation work is straightforward and doesn't require third parallel agent. Two subagents sufficient for verification and quality assurance.

### Coordination Strategy
1. codebase-analyzer runs first to extract implementation truth
2. Documentation updates (Tasks 1-5) use analyzer output as reference
3. context-synthesis runs after documentation complete to catch issues
4. Task 6 (verification test) addresses any gaps found by synthesis agent

## Alternative Approach (Not Recommended)

### Option 2: Comprehensive API Documentation Rewrite
Instead of targeted updates, completely rewrite API documentation to include full OpenAPI/Swagger specifications, add examples for all endpoints, and create separate authentication guide.

**Why Not Recommended**:
- Out of scope for ticket (ticket asks for template and docs updates only)
- Significantly more time investment (8-10 hours vs 1-2 hours)
- Swagger UI already exists at `/docs` endpoint
- Over-engineering for current needs
- Delays ticket completion without proportional value

**When This Would Be Better**:
- If preparing for external API consumers
- If comprehensive API documentation is a separate strategic goal
- If OpenAPI spec needed for tooling/code generation

## Final Gate

### Success Criteria Summary
✅ All admin auth environment variables documented in backend/.env.example
✅ env_setup.md includes admin authentication section with security guidance
✅ api.md documents three new endpoints with auth requirements
✅ backend/README.md tables updated with admin auth vars and endpoints
✅ Root README.md API routes table includes new admin endpoints
✅ Documentation verification test created and passing
✅ No inconsistencies between documentation files
✅ All documentation matches actual implementation (75f3050)

### Metrics
- **Tasks**: 6 total
- **Milestones**: 4 (M1-M4)
- **New Test**: 1 (env-example.test.ts)
- **Files Modified**: 5 documentation files + 1 new test file
- **Estimated Duration**: 1.5-2 hours for sequential execution

### Next Command
```bash
/execute "memory-bank/plan/2026-01-13_17-00-00_docs-env-updates.md"
```

## Notes

**Critical Success Factor**: Documentation must precisely mirror implementation. Use actual source code as single source of truth, not assumptions or memory.

**Documentation Philosophy**:
- Concise over comprehensive
- Actionable over theoretical
- Examples over prose
- Consistency over creativity

**Key Insight**: This plan focuses exclusively on synchronizing documentation with code. No code changes, no new features, no refactoring. Pure documentation alignment.
